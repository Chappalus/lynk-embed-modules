!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).LynkSDK={})}(this,function(e){"use strict";class t{constructor(e,t=!1){this.prefix=e,this.debugMode=t}log(e,t,...n){if(!this.debugMode&&"debug"===e)return;const i=`[${(new Date).toISOString()}] [${this.prefix}] [${e.toUpperCase()}] ${t}`;switch(e){case"error":console.error(i,...n);break;case"warn":console.warn(i,...n);break;case"info":console.info(i,...n);break;default:console.log(i,...n)}}debug(e,...t){this.log("debug",e,...t)}info(e,...t){this.log("info",e,...t)}warn(e,...t){this.log("warn",e,...t)}error(e,...t){this.log("error",e,...t)}}function n(e,t,n=365){const i=new Date(Date.now()+864e5*n).toUTCString();document.cookie=`${e}=${encodeURIComponent(t)}; expires=${i}; path=/; SameSite=Lax`}function i(e,t,n,i){return new(n||(n=Promise))(function(o,a){function s(e){try{r(i.next(e))}catch(e){a(e)}}function l(e){try{r(i.throw(e))}catch(e){a(e)}}function r(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,l)}r((i=i.apply(e,t||[])).next())})}"function"==typeof SuppressedError&&SuppressedError;class o{constructor(e){this.queue=[],this.flushInterval=null,this.FLUSH_INTERVAL_MS=5e3,this.MAX_QUEUE_SIZE=100,this.config=Object.assign({apiBaseUrl:"https://api.lynk.coach/v1"},e),this.logger=new t("LynkAPI",e.debug),this.startFlushInterval()}startFlushInterval(){this.flushInterval||(this.flushInterval=window.setInterval(()=>{this.flush()},this.FLUSH_INTERVAL_MS))}stopFlushInterval(){this.flushInterval&&(clearInterval(this.flushInterval),this.flushInterval=null)}track(e){return i(this,void 0,void 0,function*(){this.queue.length>=this.MAX_QUEUE_SIZE&&(this.logger.warn("Queue full, flushing immediately"),yield this.flush());const t=Object.assign(Object.assign({},e),{timestamp:e.timestamp||Date.now(),academyId:this.config.academyId,sessionId:this.getSessionId(),url:window.location.href,referrer:document.referrer,userAgent:navigator.userAgent});this.queue.push(t),this.logger.debug("Event queued",t.eventName)})}flush(){return i(this,void 0,void 0,function*(){if(0===this.queue.length)return;const e=[...this.queue];this.queue=[];try{const t=yield fetch(`${this.config.apiBaseUrl}/events`,{method:"POST",headers:{"Content-Type":"application/json","X-Lynk-API-Key":this.config.apiKey},body:JSON.stringify({events:e}),keepalive:!0});if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);this.logger.debug(`Flushed ${e.length} events`)}catch(t){this.logger.error("Failed to flush events",t),this.queue=[...e.slice(0,50),...this.queue].slice(0,this.MAX_QUEUE_SIZE)}})}getAcademyConfig(){return i(this,void 0,void 0,function*(){const e=yield fetch(`${this.config.apiBaseUrl}/academies/${this.config.academyId}/embed-config`,{headers:{"X-Lynk-API-Key":this.config.apiKey}});if(!e.ok)throw new Error(`Failed to fetch academy config: ${e.status}`);return e.json()})}getBatches(){return i(this,void 0,void 0,function*(){const e=yield fetch(`${this.config.apiBaseUrl}/academies/${this.config.academyId}/batches?available=true`,{headers:{"X-Lynk-API-Key":this.config.apiKey}});if(!e.ok)throw new Error(`Failed to fetch batches: ${e.status}`);return e.json()})}getAppointmentSlots(e){return i(this,void 0,void 0,function*(){const t=new URL(`${this.config.apiBaseUrl}/academies/${this.config.academyId}/appointments`);e&&t.searchParams.set("date",e);const n=yield fetch(t.toString(),{headers:{"X-Lynk-API-Key":this.config.apiKey}});if(!n.ok)throw new Error(`Failed to fetch appointment slots: ${n.status}`);return n.json()})}createBooking(e){return i(this,void 0,void 0,function*(){const t=yield fetch(`${this.config.apiBaseUrl}/bookings`,{method:"POST",headers:{"Content-Type":"application/json","X-Lynk-API-Key":this.config.apiKey},body:JSON.stringify(Object.assign(Object.assign({},e),{academyId:this.config.academyId}))});if(!t.ok)throw new Error(`Failed to create booking: ${t.status}`);return t.json()})}getSessionId(){var e;const t=`lynk_session_${this.config.academyId}`;let n=null===(e=document.cookie.match(new RegExp("(^| )"+t+"=([^;]+)")))||void 0===e?void 0:e[2];if(!n){n=`${Date.now()}-${Math.random().toString(36).substr(2,9)}`;const e=new Date(Date.now()+18e5).toUTCString();document.cookie=`${t}=${n}; expires=${e}; path=/; SameSite=Lax`}return n}destroy(){this.stopFlushInterval(),this.flush()}}class a{constructor(e){this.initialized=!1,this.eventQueue=[],this.config=Object.assign({apiBaseUrl:"https://api.lynk.coach/v1",autoPageView:!0},e),this.logger=new t("LynkPixel",e.debug),this.api=new o(e)}init(){this.initialized?this.logger.warn("Pixel already initialized"):/bot|crawler|spider|crawling/i.test(navigator.userAgent)?this.logger.info("Bot detected, skipping pixel initialization"):(this.logger.info("Initializing Lynk Pixel",{academyId:this.config.academyId,pixels:Object.keys(this.config.pixels).filter(e=>this.config.pixels[e])}),this.loadGooglePixel(),this.loadFacebookPixel(),this.loadGoogleAnalytics(),this.captureAttribution(),this.config.autoPageView&&(this.trackPageView(),this.setupHistoryTracking()),this.initialized=!0,this.flushEventQueue(),window.lynkPixel=this,this.logger.info("Pixel initialized successfully"))}track(e,t){const n={name:e,data:t,timestamp:Date.now()};this.initialized?this.processEvent(n):this.eventQueue.push(n)}trackPageView(e){const t={path:(null==e?void 0:e.path)||window.location.pathname,title:(null==e?void 0:e.title)||document.title,url:window.location.href,referrer:document.referrer};this.track("page_view",t)}trackPurchase(e){this.track("purchase",e)}trackBeginCheckout(e){this.track("begin_checkout",e)}trackLead(e){this.track("generate_lead",e)}trackContact(e){this.track("contact",e)}processEvent(e){var t,n,i;this.logger.debug("Processing event",e),this.api.track({eventName:`pixel_${e.name}`,properties:e.data}),this.config.pixels.google&&!1!==(null===(t=this.config.consent)||void 0===t?void 0:t.marketing)&&this.sendToGoogle(e),this.config.pixels.facebook&&!1!==(null===(n=this.config.consent)||void 0===n?void 0:n.marketing)&&this.sendToFacebook(e),this.config.pixels.googleAnalytics&&!1!==(null===(i=this.config.consent)||void 0===i?void 0:i.analytics)&&this.sendToGA4(e)}loadGooglePixel(){if(!this.config.pixels.google)return;const e=document.createElement("script");e.async=!0,e.src=`https://www.googletagmanager.com/gtag/js?id=${this.config.pixels.google}`,document.head.appendChild(e),window.dataLayer=window.dataLayer||[],window.gtag=function(){window.dataLayer.push(arguments)},window.gtag("js",new Date),window.gtag("config",this.config.pixels.google),this.logger.debug("Google Ads pixel loaded",{id:this.config.pixels.google})}loadGoogleAnalytics(){if(this.config.pixels.googleAnalytics){if(!window.gtag){const e=document.createElement("script");e.async=!0,e.src=`https://www.googletagmanager.com/gtag/js?id=${this.config.pixels.googleAnalytics}`,document.head.appendChild(e),window.dataLayer=window.dataLayer||[],window.gtag=function(){window.dataLayer.push(arguments)},window.gtag("js",new Date)}window.gtag("config",this.config.pixels.googleAnalytics),this.logger.debug("GA4 loaded",{id:this.config.pixels.googleAnalytics})}}loadFacebookPixel(){if(!this.config.pixels.facebook)return;const e=this.config.pixels.facebook,t=`\n      !function(f,b,e,v,n,t,s)\n      {if(f.fbq)return;n=f.fbq=function(){n.callMethod?\n      n.callMethod.apply(n,arguments):n.queue.push(arguments)};\n      if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';\n      n.queue=[];t=b.createElement(e);t.async=!0;\n      t.src=v;s=b.getElementsByTagName(e)[0];\n      s.parentNode.insertBefore(t,s)}(window, document,'script',\n      'https://connect.facebook.net/en_US/fbevents.js');\n      fbq('init', '${e}');\n      fbq('track', 'PageView');\n    `,n=document.createElement("script");n.textContent=t,document.head.appendChild(n),this.logger.debug("Facebook pixel loaded",{id:e})}sendToGoogle(e){var t,n,i,o;const a=window.gtag;if(!a)return;const s={purchase:"purchase",begin_checkout:"begin_checkout",generate_lead:"generate_lead",contact:"contact",page_view:"page_view"}[e.name]||"custom";a("event",s,Object.assign({send_to:this.config.pixels.google,value:null===(t=e.data)||void 0===t?void 0:t.value,currency:(null===(n=e.data)||void 0===n?void 0:n.currency)||"USD",transaction_id:null===(i=e.data)||void 0===i?void 0:i.transactionId,items:null===(o=e.data)||void 0===o?void 0:o.items},e.data)),this.logger.debug("Sent to Google",{event:s})}sendToGA4(e){const t=window.gtag;if(!t)return;t("event",{page_view:"page_view",purchase:"purchase",begin_checkout:"begin_checkout",generate_lead:"generate_lead",contact:"contact"}[e.name]||`custom_${e.name}`,Object.assign(Object.assign({},e.data),{academy_id:this.config.academyId}))}sendToFacebook(e){var t;const n=window.fbq;if(!n)return;const i={page_view:"PageView",purchase:"Purchase",begin_checkout:"InitiateCheckout",generate_lead:"Lead",contact:"Contact"}[e.name]||"CustomEvent",o=Object.assign({content_type:"product"},e.data);(null===(t=e.data)||void 0===t?void 0:t.value)&&(o.value=e.data.value,o.currency=e.data.currency||"USD"),n("track",i,o),this.logger.debug("Sent to Facebook",{event:i})}captureAttribution(){const e=function(){const e={},t=window.location.search;return t?(new URLSearchParams(t).forEach((t,n)=>{e[n]=t}),e):e}(),t=(new Date).toISOString();if(e.utm_source||e.utm_medium||e.utm_campaign){const i={source:e.utm_source||"direct",medium:e.utm_medium||"none",campaign:e.utm_campaign,content:e.utm_content,term:e.utm_term,timestamp:t};n("lynk_attribution",JSON.stringify(i),30),this.api.track({eventName:"attribution_captured",properties:i})}e.gclid&&n("lynk_gclid",e.gclid,30),e.fbclid&&n("lynk_fbclid",e.fbclid,30)}setupHistoryTracking(){const e=history.pushState,t=history.replaceState,n=this;history.pushState=function(...t){e.apply(this,t),n.trackPageView()},history.replaceState=function(...e){t.apply(this,e),n.trackPageView()},window.addEventListener("popstate",()=>{this.trackPageView()})}flushEventQueue(){for(;this.eventQueue.length>0;){const e=this.eventQueue.shift();e&&this.processEvent(e)}}setConsent(e){this.config.consent=Object.assign(Object.assign({},this.config.consent),e),this.logger.info("Consent updated",this.config.consent)}destroy(){this.api.destroy(),this.initialized=!1}}function s(){document.querySelectorAll("script[data-academy-id]").forEach(e=>{const t=e.getAttribute("data-academy-id"),n=e.getAttribute("data-api-key"),i=e.getAttribute("data-google-pixel"),o=e.getAttribute("data-facebook-pixel"),s=e.getAttribute("data-ga4-id"),l="true"===e.getAttribute("data-debug");if(!t||!n)return void console.error("Lynk Pixel: academy-id and api-key are required");new a({academyId:t,apiKey:n,debug:l,pixels:{google:i||void 0,facebook:o||void 0,googleAnalytics:s||void 0}}).init()})}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",s):s();class l{constructor(e){this.container=null,this.modal=null,this.overlay=null,this.academyConfig=null,this.batches=[],this.appointmentSlots=[],this.currentStep="select",this.selectedItem=null,this.config=Object.assign({apiBaseUrl:"https://api.lynk.coach/v1",type:"both",buttonText:"Get in Touch",buttonStyle:"default",buttonSize:"medium",theme:{},modalTitle:"Book with Us",successMessage:"Thank you! We will contact you shortly."},e),this.logger=new t("LynkButton",e.debug),this.api=new o(this.config)}init(){return i(this,void 0,void 0,function*(){if(this.logger.info("Initializing Lynk Button"),"string"==typeof this.config.selector?this.container=document.querySelector(this.config.selector):this.container=this.config.selector,!this.container)throw new Error(`Container not found: ${this.config.selector}`);try{this.academyConfig=yield this.api.getAcademyConfig(),this.logger.debug("Academy config loaded",this.academyConfig)}catch(e){this.logger.error("Failed to load academy config",e)}this.renderButton(),this.config.autoOpen&&this.openModal(),this.logger.info("Button initialized")})}renderButton(){if(!this.container)return;const e=document.createElement("button");e.className=`lynk-btn lynk-btn--${this.config.buttonStyle} lynk-btn--${this.config.buttonSize}`,e.textContent=this.config.buttonText,e.onclick=()=>this.openModal(),this.applyButtonStyles(e),this.container.appendChild(e),this.injectStyles()}applyButtonStyles(e){const t=this.config.theme,n={};t.primaryColor&&("default"===this.config.buttonStyle?(n.backgroundColor=t.primaryColor,n.borderColor=t.primaryColor):(n.color=t.primaryColor,n.borderColor=t.primaryColor)),t.textColor&&"default"===this.config.buttonStyle&&(n.color=t.textColor),t.borderRadius&&(n.borderRadius=t.borderRadius),t.fontFamily&&(n.fontFamily=t.fontFamily),t.fontSize&&(n.fontSize=t.fontSize),t.shadow&&(n.boxShadow="0 2px 8px rgba(0,0,0,0.15)"),Object.assign(e.style,n)}injectStyles(){if(document.getElementById("lynk-button-styles"))return;const e=document.createElement("style");e.id="lynk-button-styles",e.textContent="\n      .lynk-btn {\n        display: inline-flex;\n        align-items: center;\n        justify-content: center;\n        padding: 12px 24px;\n        font-weight: 600;\n        cursor: pointer;\n        transition: all 0.2s ease;\n        border: 2px solid transparent;\n        text-decoration: none;\n        line-height: 1.5;\n      }\n\n      .lynk-btn--small { padding: 8px 16px; font-size: 14px; }\n      .lynk-btn--medium { padding: 12px 24px; font-size: 16px; }\n      .lynk-btn--large { padding: 16px 32px; font-size: 18px; }\n\n      .lynk-btn--default {\n        background: #007bff;\n        color: white;\n        border-radius: 8px;\n      }\n      .lynk-btn--default:hover {\n        background: #0056b3;\n        transform: translateY(-1px);\n      }\n\n      .lynk-btn--outline {\n        background: transparent;\n        color: #007bff;\n        border-color: #007bff;\n        border-radius: 8px;\n      }\n      .lynk-btn--outline:hover {\n        background: #007bff;\n        color: white;\n      }\n\n      .lynk-btn--minimal {\n        background: transparent;\n        color: #007bff;\n        padding: 8px 0;\n        text-decoration: underline;\n      }\n\n      .lynk-btn:active {\n        transform: translateY(0);\n      }\n\n      /* Modal Styles */\n      .lynk-overlay {\n        position: fixed;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        background: rgba(0,0,0,0.5);\n        z-index: 9998;\n        opacity: 0;\n        transition: opacity 0.3s ease;\n      }\n      .lynk-overlay.active { opacity: 1; }\n\n      .lynk-modal {\n        position: fixed;\n        top: 50%;\n        left: 50%;\n        transform: translate(-50%, -50%) scale(0.95);\n        background: white;\n        border-radius: 12px;\n        box-shadow: 0 20px 60px rgba(0,0,0,0.3);\n        z-index: 9999;\n        max-width: 480px;\n        width: 90%;\n        max-height: 85vh;\n        opacity: 0;\n        transition: all 0.3s ease;\n        display: flex;\n        flex-direction: column;\n      }\n      .lynk-modal.active {\n        opacity: 1;\n        transform: translate(-50%, -50%) scale(1);\n      }\n\n      .lynk-modal__header {\n        padding: 20px 24px;\n        border-bottom: 1px solid #e5e5e5;\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n      }\n\n      .lynk-modal__title {\n        margin: 0;\n        font-size: 20px;\n        font-weight: 600;\n      }\n\n      .lynk-modal__close {\n        background: none;\n        border: none;\n        font-size: 24px;\n        cursor: pointer;\n        padding: 0;\n        width: 32px;\n        height: 32px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        border-radius: 50%;\n        transition: background 0.2s;\n      }\n      .lynk-modal__close:hover { background: #f0f0f0; }\n\n      .lynk-modal__content {\n        padding: 24px;\n        overflow-y: auto;\n        flex: 1;\n      }\n\n      .lynk-modal__footer {\n        padding: 16px 24px;\n        border-top: 1px solid #e5e5e5;\n        display: flex;\n        justify-content: flex-end;\n        gap: 12px;\n      }\n\n      /* Tabs */\n      .lynk-tabs {\n        display: flex;\n        gap: 8px;\n        margin-bottom: 20px;\n        border-bottom: 2px solid #e5e5e5;\n      }\n\n      .lynk-tab {\n        padding: 12px 16px;\n        background: none;\n        border: none;\n        cursor: pointer;\n        font-weight: 500;\n        color: #666;\n        border-bottom: 2px solid transparent;\n        margin-bottom: -2px;\n        transition: all 0.2s;\n      }\n      .lynk-tab:hover { color: #333; }\n      .lynk-tab.active {\n        color: #007bff;\n        border-bottom-color: #007bff;\n      }\n\n      /* Item Cards */\n      .lynk-item {\n        padding: 16px;\n        border: 2px solid #e5e5e5;\n        border-radius: 8px;\n        margin-bottom: 12px;\n        cursor: pointer;\n        transition: all 0.2s;\n      }\n      .lynk-item:hover {\n        border-color: #007bff;\n        background: #f8f9ff;\n      }\n      .lynk-item.selected {\n        border-color: #007bff;\n        background: #f0f5ff;\n      }\n\n      .lynk-item__name {\n        font-weight: 600;\n        margin-bottom: 4px;\n      }\n\n      .lynk-item__meta {\n        font-size: 14px;\n        color: #666;\n      }\n\n      .lynk-item__price {\n        font-weight: 600;\n        color: #007bff;\n        margin-top: 8px;\n      }\n\n      /* Form */\n      .lynk-form-group {\n        margin-bottom: 16px;\n      }\n\n      .lynk-form-label {\n        display: block;\n        margin-bottom: 6px;\n        font-weight: 500;\n        font-size: 14px;\n      }\n\n      .lynk-form-input,\n      .lynk-form-select,\n      .lynk-form-textarea {\n        width: 100%;\n        padding: 10px 12px;\n        border: 1px solid #d0d0d0;\n        border-radius: 6px;\n        font-size: 16px;\n        transition: border-color 0.2s;\n      }\n      .lynk-form-input:focus,\n      .lynk-form-select:focus,\n      .lynk-form-textarea:focus {\n        outline: none;\n        border-color: #007bff;\n      }\n\n      .lynk-form-textarea {\n        min-height: 100px;\n        resize: vertical;\n      }\n\n      /* Buttons */\n      .lynk-btn-primary {\n        background: #007bff;\n        color: white;\n        border: none;\n        padding: 12px 24px;\n        border-radius: 6px;\n        font-weight: 600;\n        cursor: pointer;\n        transition: all 0.2s;\n      }\n      .lynk-btn-primary:hover { background: #0056b3; }\n      .lynk-btn-primary:disabled {\n        background: #ccc;\n        cursor: not-allowed;\n      }\n\n      .lynk-btn-secondary {\n        background: transparent;\n        color: #666;\n        border: 1px solid #d0d0d0;\n        padding: 12px 24px;\n        border-radius: 6px;\n        font-weight: 600;\n        cursor: pointer;\n        transition: all 0.2s;\n      }\n      .lynk-btn-secondary:hover {\n        background: #f0f0f0;\n      }\n\n      /* Success State */\n      .lynk-success {\n        text-align: center;\n        padding: 40px 20px;\n      }\n\n      .lynk-success__icon {\n        width: 64px;\n        height: 64px;\n        background: #28a745;\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        margin: 0 auto 20px;\n        color: white;\n        font-size: 32px;\n      }\n\n      .lynk-success__title {\n        font-size: 24px;\n        font-weight: 600;\n        margin-bottom: 12px;\n      }\n\n      .lynk-success__message {\n        color: #666;\n        line-height: 1.6;\n      }\n\n      /* Loading */\n      .lynk-loading {\n        text-align: center;\n        padding: 40px;\n      }\n\n      .lynk-spinner {\n        width: 40px;\n        height: 40px;\n        border: 3px solid #e5e5e5;\n        border-top-color: #007bff;\n        border-radius: 50%;\n        animation: lynk-spin 1s linear infinite;\n        margin: 0 auto 16px;\n      }\n\n      @keyframes lynk-spin {\n        to { transform: rotate(360deg); }\n      }\n\n      /* Responsive */\n      @media (max-width: 480px) {\n        .lynk-modal {\n          width: 95%;\n          max-height: 90vh;\n        }\n      }\n    ",document.head.appendChild(e)}openModal(){return i(this,void 0,void 0,function*(){this.modal||(this.overlay=document.createElement("div"),this.overlay.className="lynk-overlay",this.overlay.onclick=()=>this.closeModal(),document.body.appendChild(this.overlay),this.modal=document.createElement("div"),this.modal.className="lynk-modal",this.modal.innerHTML=`\n      <div class="lynk-modal__header">\n        <h3 class="lynk-modal__title">${this.config.modalTitle}</h3>\n        <button class="lynk-modal__close">&times;</button>\n      </div>\n      <div class="lynk-modal__content">\n        <div class="lynk-loading">\n          <div class="lynk-spinner"></div>\n          <p>Loading...</p>\n        </div>\n      </div>\n    `,this.modal.querySelector(".lynk-modal__close").addEventListener("click",()=>this.closeModal()),document.body.appendChild(this.modal),requestAnimationFrame(()=>{var e,t;null===(e=this.overlay)||void 0===e||e.classList.add("active"),null===(t=this.modal)||void 0===t||t.classList.add("active")}),yield this.loadData(),this.renderSelectionStep())})}closeModal(){var e,t;null===(e=this.overlay)||void 0===e||e.classList.remove("active"),null===(t=this.modal)||void 0===t||t.classList.remove("active"),setTimeout(()=>{var e,t;null===(e=this.overlay)||void 0===e||e.remove(),null===(t=this.modal)||void 0===t||t.remove(),this.overlay=null,this.modal=null},300)}loadData(){return i(this,void 0,void 0,function*(){try{if("booking"!==this.config.type&&"both"!==this.config.type||(this.batches=yield this.api.getBatches()),"appointment"===this.config.type||"both"===this.config.type){const e=(new Date).toISOString().split("T")[0];this.appointmentSlots=yield this.api.getAppointmentSlots(e)}}catch(e){this.logger.error("Failed to load data",e)}})}renderSelectionStep(){if(!this.modal)return;const e=this.modal.querySelector(".lynk-modal__content");let t="";if("both"===this.config.type&&this.batches.length>0&&this.appointmentSlots.length>0&&(t+='\n        <div class="lynk-tabs">\n          <button class="lynk-tab active" data-tab="batches">Join a Batch</button>\n          <button class="lynk-tab" data-tab="appointments">Book Appointment</button>\n        </div>\n      '),this.batches.length>0&&(t+='<div class="lynk-section" id="lynk-batches">',t+=this.batches.map(e=>`\n        <div class="lynk-item" data-type="batch" data-id="${e.id}">\n          <div class="lynk-item__name">${e.name}</div>\n          <div class="lynk-item__meta">${e.schedule} • ${e.coachName||"TBD"}</div>\n          ${e.availableSpots<10?`<div class="lynk-item__meta" style="color: #dc3545;">Only ${e.availableSpots} spots left</div>`:""}\n          <div class="lynk-item__price">${e.currency} ${e.price}</div>\n        </div>\n      `).join(""),t+="</div>"),this.appointmentSlots.length>0){t+='<div class="lynk-section" id="lynk-appointments" style="display: none;">';const e=this.groupAppointmentsByDate(this.appointmentSlots);for(const[n,i]of Object.entries(e))t+=`<div style="margin-bottom: 16px;"><strong>${this.formatDate(n)}</strong></div>`,t+=i.map(e=>`\n          <div class="lynk-item" data-type="appointment" data-id="${e.id}">\n            <div class="lynk-item__name">${e.time} (${e.duration} min)</div>\n            ${e.coachName?`<div class="lynk-item__meta">with ${e.coachName}</div>`:""}\n          </div>\n        `).join("");t+="</div>"}0===this.batches.length&&0===this.appointmentSlots.length&&(t='\n        <div style="text-align: center; padding: 40px;">\n          <p>No bookings available at the moment.</p>\n          <p>Please contact us directly.</p>\n        </div>\n      '),e.innerHTML=t,e.querySelectorAll(".lynk-tab").forEach(t=>{t.addEventListener("click",t=>{const n=t.target,i=n.dataset.tab;e.querySelectorAll(".lynk-tab").forEach(e=>e.classList.remove("active")),n.classList.add("active"),e.querySelector("#lynk-batches").style.display="batches"===i?"block":"none",e.querySelector("#lynk-appointments").style.display="appointments"===i?"block":"none"})}),e.querySelectorAll(".lynk-item").forEach(t=>{t.addEventListener("click",()=>{const n=t.getAttribute("data-type"),i=t.getAttribute("data-id");e.querySelectorAll(".lynk-item").forEach(e=>e.classList.remove("selected")),t.classList.add("selected"),this.selectedItem="batch"===n?this.batches.find(e=>e.id===i)||null:this.appointmentSlots.find(e=>e.id===i)||null,this.renderFormStep()})})}renderFormStep(){if(!this.modal||!this.selectedItem)return;const e=this.modal.querySelector(".lynk-modal__content"),t="price"in this.selectedItem;e.innerHTML=`\n      <div style="margin-bottom: 20px; padding: 12px; background: #f8f9ff; border-radius: 8px;">\n        <strong>${this.selectedItem.name||this.selectedItem.time}</strong>\n        ${t?`<br><span style="color: #666;">${this.selectedItem.schedule}</span>`:""}\n      </div>\n\n      <form id="lynk-booking-form">\n        <div class="lynk-form-group">\n          <label class="lynk-form-label">Full Name *</label>\n          <input type="text" class="lynk-form-input" name="name" required placeholder="Enter your full name">\n        </div>\n\n        <div class="lynk-form-group">\n          <label class="lynk-form-label">Phone Number *</label>\n          <input type="tel" class="lynk-form-input" name="phone" required placeholder="Enter your phone number">\n        </div>\n\n        <div class="lynk-form-group">\n          <label class="lynk-form-label">Email Address *</label>\n          <input type="email" class="lynk-form-input" name="email" required placeholder="Enter your email">\n        </div>\n\n        ${t?'\n        <div class="lynk-form-group">\n          <label class="lynk-form-label">Student Name (if different)</label>\n          <input type="text" class="lynk-form-input" name="studentName" placeholder="Enter student\'s name">\n        </div>\n\n        <div class="lynk-form-group">\n          <label class="lynk-form-label">Student Age</label>\n          <input type="number" class="lynk-form-input" name="studentAge" min="3" max="100" placeholder="Enter student\'s age">\n        </div>\n        ':'\n        <div class="lynk-form-group">\n          <label class="lynk-form-label">What would you like to discuss?</label>\n          <textarea class="lynk-form-textarea" name="notes" placeholder="Tell us briefly what you\'re looking for..."></textarea>\n        </div>\n        '}\n\n        <button type="submit" class="lynk-btn-primary" style="width: 100%;">\n          ${t?"Request Enrollment":"Book Appointment"}\n        </button>\n      </form>\n    `;const n=e.querySelector("#lynk-booking-form");n.addEventListener("submit",e=>{e.preventDefault(),this.handleSubmit(new FormData(n))});const i=this.modal.querySelector(".lynk-modal__footer")||document.createElement("div");i.className="lynk-modal__footer",i.innerHTML='<button class="lynk-btn-secondary" id="lynk-back">← Back</button>',this.modal.appendChild(i),i.querySelector("#lynk-back").addEventListener("click",()=>{i.remove(),this.selectedItem=null,this.renderSelectionStep()})}handleSubmit(e){return i(this,void 0,void 0,function*(){var t,n,i,o,a,s,l;const r=null===(t=this.modal)||void 0===t?void 0:t.querySelector(".lynk-btn-primary");r&&(r.disabled=!0,r.textContent="Processing...");const c={type:"price"in this.selectedItem?"batch":"appointment",itemId:this.selectedItem.id,customer:{name:e.get("name"),phone:e.get("phone"),email:e.get("email")},details:Object.fromEntries(e.entries())};try{const e=yield this.api.createBooking(c);this.logger.info("Booking created",e),window.lynkPixel&&(null===(i=(n=window.lynkPixel).trackPurchase)||void 0===i||i.call(n,{value:"price"in this.selectedItem?this.selectedItem.price:0,currency:"price"in this.selectedItem?this.selectedItem.currency:"USD",transactionId:e.id})),this.renderSuccessStep(),null===(a=(o=this.config).onBookingSuccess)||void 0===a||a.call(o,e)}catch(e){this.logger.error("Booking failed",e),r&&(r.disabled=!1,r.textContent="price"in this.selectedItem?"Request Enrollment":"Book Appointment"),alert("Something went wrong. Please try again or contact us directly."),null===(l=(s=this.config).onBookingError)||void 0===l||l.call(s,e)}})}renderSuccessStep(){var e;if(!this.modal)return;null===(e=this.modal.querySelector(".lynk-modal__footer"))||void 0===e||e.remove();this.modal.querySelector(".lynk-modal__content").innerHTML=`\n      <div class="lynk-success">\n        <div class="lynk-success__icon">✓</div>\n        <div class="lynk-success__title">All Set!</div>\n        <div class="lynk-success__message">${this.config.successMessage}</div>\n      </div>\n    `,setTimeout(()=>this.closeModal(),5e3)}groupAppointmentsByDate(e){return e.reduce((e,t)=>(e[t.date]||(e[t.date]=[]),e[t.date].push(t),e),{})}formatDate(e){const t=new Date(e),n=new Date,i=new Date(n);return i.setDate(i.getDate()+1),e===n.toISOString().split("T")[0]?"Today":e===i.toISOString().split("T")[0]?"Tomorrow":t.toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric"})}destroy(){this.closeModal(),this.api.destroy()}}function r(){document.querySelectorAll("script[data-academy-id]").forEach(e=>{const t=e.getAttribute("data-academy-id"),n=e.getAttribute("data-api-key"),i=e.getAttribute("data-selector")||"#lynk-button",o=e.getAttribute("data-type")||"both",a=e.getAttribute("data-button-text")||void 0,s="true"===e.getAttribute("data-debug");if(!t||!n)return void console.error("Lynk Button: academy-id and api-key are required");new l({selector:i,academyId:t,apiKey:n,type:o,buttonText:a,debug:s}).init()})}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",r):r();var c={Pixel:a,Button:l,version:"1.0.0"};e.LynkButton=l,e.LynkPixel=a,e.default=c,Object.defineProperty(e,"__esModule",{value:!0})});
